{
  "hash": "a2421dc549ce9328a5dbfc90229e6c98",
  "result": {
    "markdown": "---\ntitle: \"Replicating the analysis of Skene et al, 2020\"\nauthor: \"Arvid Harder\"\ndate: \"2022-06-29\"\ncategories: [genetics, scRNA]\nformat:\n  html:\n    code-fold: true\n    code-link: true\nexecute: \n  echo: true\n---\n\n\nThis past month has got me interested in the intersection of neuroscience and genetics - especially how to combine single-cell RNA sequencing data with that of genome-wide association studies. There are several foundational papers in this intersection, and here i replicate the analysis from a paper focusing on brain disorders - [Genetic identification of cell types underlying brain complex traits yields insights into the etiology of Parkinson's disease](https://www.nature.com/articles/s41588-020-0610-9).\n\nTo get started we first download some data!\n\n-   [scRNA data](https://pubmed.ncbi.nlm.nih.gov/30096314/)\n\n-   GWAS of major depressive disorder\n\n-   GWAS of schizophrenia\n\n-   GWAS of bipolar disorder\n\n## Download data\n\n\n::: {.cell}\n\n```{.bash .cell-code}\n\n# First we download the aggregated gene expression data for 265 clusters of cell-types from\n# adolescent mouse brain\nwget https://storage.googleapis.com/linnarsson-lab-loom/l5_all.agg.loom\n\n# MDD\nwget -O mdd.gz https://datashare.ed.ac.uk/bitstream/handle/10283/3203/PGC_UKB_depression_genome-wide.txt?sequence=3&isAllowed=y\n\n# Bipolar disorder\nwget -O bip.gz https://figshare.com/ndownloader/files/26603681\n\n# Schizophenia\nwget -O scz.gz https://figshare.com/ndownloader/files/34517807\n\n# testing update\necho hello\n```\n:::\n\n\n## Prepare gene-sets based on the level 4 cell-types\n\nFor ease of visualization i will prepare gene-sets from each of the level 4 cell-types, as plotting 265 cell-types is **slightly** overkill. We start off by loading our packages,and defining some helper functions.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(data.table)\nlibrary(tidyverse)\nlibrary(ggplot2)\nlibrary(rhdf5)\nlibrary(janitor)\nlibrary(fs)\nlibrary(glue)\n\nscale_to_1tpm <- function(tbl, var) {\n  stopifnot(\"expr\" %in% colnames(tbl))\n  tbl %>% \n    group_by(.data[[var]]) %>% \n    mutate(expr = expr*1000000 / sum(expr)) %>% \n    ungroup()\n}\n\ngene_specificity <- function(tbl, var) {\n  # Here we compute the central metric: gene specificity.\n  # Gene specificty isa %, how much of the genes total expression over all tissues\n  # is in the index cell-type?\n  \n  tbl %>% \n    group_by(.data[[var]]) %>% \n    mutate(specificity = expr/sum(expr)) %>% \n    ungroup()\n}\n\n\nextract_top_10_pct <- function(tbl) {\n  tbl %>% \n    arrange(desc(specificity)) %>% \n    slice_head(n = round(nrow(.)/10))  \n}\n\nmunge_magma_genesets <- function(tbl, name) {\n  tbl %>%\n    # make the cell type names easy to work with\n    mutate( name := make_clean_names({{ name }}))\n  \n}\n\n# open aggregated expr data\n# df_h5 <- H5Fopen(\"data/zeisel_2018/l5_all.agg.loom\")\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nprint(getwd())\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n[1] \"/Volumes/arvhar/Project/academic_blog/posts/hello-world\"\n```\n:::\n:::\n",
    "supporting": [],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}